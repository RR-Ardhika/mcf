<!DOCTYPE html>
<html>
<head>
	<title>My Custom Food</title>
	<link rel="stylesheet" type="text/css" href="../asset/css/materialize.min.css">
	<link rel="stylesheet" type="text/css" href="../asset/css/style.css">
	<link rel="stylesheet" type="text/css" href="../asset/css/order.css">
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	
	
	<script type="text/javascript" src ="../asset/js/general.js"></script>
	<script type="text/javascript" src ="../asset/js/order.js"></script>
	<!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
	<!-- jQuery / jQuery UI -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

	<!-- jQuery Touch Punch - Enable Touch Drag and Drop -->
	<script src="../core/vendor/jquery.touch-punch.min.js"></script>

	<!-- jQuery.Shapeshift -->
	<script src="../core/jquery.shapeshift.js"></script>
	
	<!-- CSS -->
	<style>
		.mcf-menu {
			border: 1px dashed #CCC;
			display: inline-block;
			position: relative;
			width: 120px;
			min-height: 422px;
		}

		.mcf-menu > div {
			background: #AAA;
			position: absolute;
			height: 100px;
			width: 100px;
		}

		.mcf-menu > .ss-placeholder-child {
			background: transparent;
			border: 1px dashed blue;
		}
		
		.mcf-order {
			display: inline-block;
			position: relative;
			width: 600px;
			height: 318px;
		}
		
		.mcf-order-show {
			border: 1px dashed #CCC;
			min-height: 300px;
		}
		
		.mcf-order-droparea {
			border: 1px dashed #CCC;
			position: relative;
			width: 79%;
			min-height: 122px;
			display: inline-block;
		}
		
		.mcf-order-droparea > div {
			background: #AAA;
			position: absolute;
			height: 100px;
			width: 100px;
		}

		.mcf-order-droparea > .ss-placeholder-child {
			background: transparent;
			border: 1px dashed blue;
		}
		
		.mcf-order-trash {
			border: 1px dashed red;
			width: 20%;
			min-height: 122px;
			display: inline-block;
		}
	</style>

	<!-- Javascript -->
	<script>
		var cart = "";
		var redCart = ""; // redundant cart
		// var objCart = [];
		// var trash = [];
		// var index = 0;
	
		$(document).ready(function() {
		
			// Init mcf-show to show blank
			$("#mcf-show").removeAttr("src");
			
			// Init shapeshift
			$(".mcf-menu").shapeshift({
				dragClone: true,
				enableCrossDrop: false,
				autoHeight: false,
				gutterY: 50,
			});
			
			$(".mcf-order-droparea").shapeshift({
				colWidth: 100,
				autoHeight: false,
			});
			
			$(".mcf-order-trash").shapeshift({
				colWidth: 100,
				enableTrash: true,
				autoHeight: false,
			});
			
			// Events
			var menu_area = $(".mcf-menu");
			$(menu_area).on("ss-removed", function (e, selected) {
				// console.log($(selected));
			});
			
			var drop_area = $(".mcf-order-droparea");
			$(drop_area).on("ss-added", function (e, selected) {
				// console.log($(this));
				// console.log($(selected).context.id);
				// console.log("Into this position:" + $(selected).index());
				// console.log(getFoodId($(selected).context.id));
				// $("#mcf-show").attr("src", "../asset/img/foods/3.jpg");
				
				addFood(getFoodId($(selected).context.id));				
				
				// objCart = drop_area;
				// objCart = objCart[0].children;
				
				var secret_number = Math.floor((Math.random() * 10000000000));
				$(selected).attr("name", secret_number);
				
				debugFoodName(selected);
				
				// console.log(secret_number);
				// $(selected)[0].children.secret_number = secret_number;
				// objCart[index].secret_number = secret_number;
				// index++;				
				// console.log(objCart[index-1].secret_number);
				// objCart.push($(selected));
				// $(e).data = secret_number;
				// console.log($(this));
				// console.log($(e));
				
				// console.log($(selected).attr("name"));
				
			});
			
			var trash_area = $(".mcf-order-trash");
			$(trash_area).on("ss-trashed", function (e, selected) {
				// console.log(getFoodId($(selected).context.id));
				// console.log($(selected.parent));
				// console.log($(selected)[0]);
				// trash = trash_area;
				// trash.push($(selected));
				// console.log(objCart[0]);
				// console.log(trash[0]);
				
				// console.log($(selected).attr("name"));
				
				// console.log($(e));
				// console.log($(selected));
				
				debugFoodName(selected);
				if ($(selected).attr("name"))
					removeFood(getFoodId($(selected).context.id));
				
				// // console.log(findInRedCart($(selected)));
				// debugCart();
				
			});
			
		});
		
		function getFoodId(food)
		{
			return food.replace('item', '');
		}
		
		function sortFoodId(str)
		{
			var tmp = str.split("");
			tmp = tmp.sort();
			return tmp.toString().replace(/,/g, '');	
		}
		
		function sortCart()
		{
			cart = sortFoodId(cart);
		}
		
		function countCart(foodId)
		{
			var regex = new RegExp(foodId, "g");
			return cart.match(regex).length;
		}
		
		function sortRedCart()
		{
			redCart = sortFoodId(redCart);
		}
		
		function countRedCart(foodId)
		{			
			var regex = new RegExp(foodId, "g");
			return redCart.match(regex).length;
		}
		
		// function findInRedCart(food)
		// {
		// 	for (i = 0; i < redCart.length; i++) {
		// 		console.log(objCart[i].context.className.toString());
		// 		console.log(food.context.className.toString());
		// 		if (objCart[i].context.className.toString() === food.context.className.toString()) {
		// 			return true;
		// 		}
		// 	}
		// 	return false;
		// }
		
		function addFood(foodId)
		{
			if (!cart.includes(foodId)) {
				cart = cart.concat(foodId);
				sortCart();
			}
			redCart = redCart.concat(foodId);
			sortRedCart();
			debugCart();
			showFood(cart);
		}
		
		function removeFood(foodId)
		{
			if (countRedCart(foodId) > 1) {
				redCart = redCart.replace(foodId, '');
			} else if (countRedCart(foodId) == 1) {
				redCart = redCart.replace(foodId, '');
				cart = cart.replace(foodId, '');
			} else {
				return;
			}
			debugCart();
			showFood(cart);
		}
		
		function showFood(foodId)
		{
			if (foodId.length > 0)
				$("#mcf-show").attr("src", "../asset/img/foods/" + foodId + ".jpg");
			else
				$("#mcf-show").removeAttr("src");
		}
		
		function debugCart()
		{
			// console.log(cart);
			// console.log(redCart);
		}
		
		function debugFoodName(selected)
		{
			// console.log($(selected).attr("name"));
		}
		
	</script>
    
</head>
<body>
	<header>
		<nav>
			<div class="nav-wrapper">
				<div class="wrapper left" id="navbar-content-left">
					<ul class="right hide-on-med-and-down">
						<li><a href="#">Home</a></li>
						<li><a href="../About/index.html">About Us</a></li>
						<li><a href="../Location/index.html">Our Location</a></li>
					</ul>
				</div>
				<div class="wrapper">
					<a href="#" class="center brand-logo">Logo</a>
				</div>
				<div class="wrapper right" id="navbar-content-right">
					<ul class="left hide-on-med-and-down">
						<li><a href="collapsible.html">Showcase</a></li>
						<li><a href="../Register/index.html">Register</a></li>
						<li><a href="../Order/index.html">Order</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</header>
	<main>
		<div class="block valign-wrapper" id="first-block">
			<div class="center container" style="padding: auto;">
				
				<div class="mcf-menu" id="mcf-menu" name="mcf-menu">
				    <div id="itemA" name=""><img src="../asset/img/foods/A.jpg" width="100" height="100" /></div>
				    <div id="itemB" name=""><img src="../asset/img/foods/B.jpg" width="100" height="100" /></div>
				    <div id="itemC" name=""><img src="../asset/img/foods/C.jpg" width="100" height="100" /></div>
				</div>

				<div class="mcf-order">					
					<div class="mcf-order-show"><img src="../asset/img/foods/A.jpg" width="598" height="290" id="mcf-show" name="mcf-show" /></div>
					<div class="mcf-order-item">
						<div class="mcf-order-droparea"></div>
						<div class="mcf-order-trash"></div>											
					</div>
				</div>
				
				<!-- <div class="mcf-menu">
				    <div id="itemD"><img src="../asset/img/foods/1.jpg" width="100" height="100" /></div>
				    <div id="itemE"><img src="../asset/img/foods/2.jpg" width="100" height="100" /></div>
				    <div id="itemF"><img src="../asset/img/foods/3.jpg" width="100" height="100" /></div>
				</div> -->
				
			</div>
		</div>
	<footer>
		
	</footer>
</body>
</html>